@model XYZ.Application.Features.ProgressRecords.Queries.GetProgressRecordById.ProgressRecordDetailDto

@{
    ViewData["Title"] = "Gelişim Kaydı Detayı";
    var canWrite = (ViewBag.CanWrite as bool?) ?? false;
}

<section class="mb-3 d-flex flex-wrap justify-content-between align-items-center gap-2">
    <div>
        <h2 class="h4 mb-1">Gelişim Kaydı Detayı</h2>
        <div class="text-muted small">
            Tarih: <span class="fw-semibold">@Model.RecordDate.ToString("dd.MM.yyyy")</span> ·
            #@Model.Sequence ·
            Şube: <span class="fw-semibold">@(!string.IsNullOrWhiteSpace(Model.BranchName) ? Model.BranchName : Model.BranchId.ToString())</span>
        </div>
        <div class="text-muted small">
            Oluşturan: <span class="fw-semibold">@(!string.IsNullOrWhiteSpace(Model.CreatedByDisplayName) ? Model.CreatedByDisplayName : "-")</span>
        </div>
    </div>

    <div class="d-flex gap-2">
        <a class="btn btn-sm btn-outline-secondary"
           asp-action="Student"
           asp-route-studentId="@Model.StudentId">
            Geri
        </a>

        @if (canWrite)
        {
            <a class="btn btn-sm btn-primary"
               asp-action="Edit" asp-route-id="@Model.Id">
                Düzenle
            </a>
        }
    </div>
</section>

<section class="card-surface p-3 mb-3">

    <h6 class="mb-2">Metrikler</h6>

    @if (Model.Values.Count == 0)
    {
        <div class="small">Metrik değeri yok.</div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-sm align-middle mb-0 table-modern pr-detail-table">
                <thead>
                    <tr class="small">
                        <th>Metrik</th>
                        <th class="text-end">Değer</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var v in Model.Values)
                    {
                        <tr>
                            <td>
                                <div>@v.MetricName</div>
                                @if (!string.IsNullOrWhiteSpace(v.Unit))
                                {
                                    <div class="text-muted small">@v.Unit</div>
                                }
                            </td>
                            <td class="text-end">
                                @{
                                    string valueText =
                                    v.DataType switch
                                    {
                                        XYZ.Domain.Enums.ProgressMetricDataType.Decimal => v.DecimalValue?.ToString("0.00") ?? "-",
                                        XYZ.Domain.Enums.ProgressMetricDataType.Int => v.IntValue?.ToString() ?? "-",
                                        XYZ.Domain.Enums.ProgressMetricDataType.Text => !string.IsNullOrWhiteSpace(v.TextValue) ? v.TextValue : "-",
                                        _ => "-"
                                    };
                                }
                                <span>@valueText</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</section>

<section class="card-surface p-3">
    <div class="row g-3">
        <div class="col-md-6">
            <h6 class="mb-2">Koç Notu</h6>
            <div class="text-muted small" style="white-space: pre-wrap;">@(!string.IsNullOrWhiteSpace(Model.CoachNotes) ? Model.CoachNotes : "-")</div>
        </div>
        <div class="col-md-6">
            <h6 class="mb-2">Hedefler</h6>
            <div class="text-muted small" style="white-space: pre-wrap;">@(!string.IsNullOrWhiteSpace(Model.Goals) ? Model.Goals : "-")</div>
        </div>
    </div>
</section>
