@model XYZ.Web.Models.Profile.ProfileViewModel
@using XYZ.Domain.Enums

@{
    ViewData["Title"] = "Profilim";

    var p = Model.Profile;
    var role = p.Role ?? "";

    var profilePictureUrl = ViewData["ProfilePictureUrl"] as string;
    var hasPhoto = !string.IsNullOrWhiteSpace(profilePictureUrl);

    string RoleLabel(string r) => r switch
    {
        "Admin" => "Admin",
        "Coach" => "Koç",
        "Student" => "Öğrenci",
        "SuperAdmin" => "Super Admin",
        _ => string.IsNullOrWhiteSpace(r) ? "-" : r
    };

    string BadgeClass(string r) => r switch
    {
        "Admin" => "bg-primary",
        "Coach" => "bg-success",
        "Student" => "bg-secondary",
        "SuperAdmin" => "bg-dark",
        _ => "bg-light text-dark border"
    };

    string GenderLabel(Gender g) => g switch
    {
        Gender.Male => "Erkek",
        Gender.Female => "Kadın",
        Gender.PreferNotToSay => "Belirtmek İstemiyorum",
        _ => "-"
    };

    string BloodLabel(BloodType b) => b switch
    {
        BloodType.Unknown => "Bilinmiyor",
        BloodType.A_Positive => "A Rh+",
        BloodType.A_Negative => "A Rh-",
        BloodType.B_Positive => "B Rh+",
        BloodType.B_Negative => "B Rh-",
        BloodType.AB_Positive => "AB Rh+",
        BloodType.AB_Negative => "AB Rh-",
        BloodType.O_Positive => "0 Rh+",
        BloodType.O_Negative => "0 Rh-",
        _ => "-"
    };
}

<div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
    <div>
        <h2 class="mb-1">Profilim</h2>
        <div class="text-muted small">
            Hesap bilgilerinizi ve rolünüze özel detayları buradan görebilirsiniz.
        </div>
    </div>

    <div class="d-flex flex-wrap gap-2">
        <a asp-controller="Profile" asp-action="Edit" class="btn btn-sm btn-outline-primary">
            Bilgilerimi Düzenle
        </a>
        <a asp-controller="Settings" asp-action="Index" class="btn btn-sm btn-outline-secondary">
            Ayarlar
        </a>
    </div>
</div>

@if (!string.IsNullOrWhiteSpace(TempData["SuccessMessage"] as string))
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<div class="row g-3">
    <div class="col-12 col-lg-4">
        <div class="card-surface p-3 h-100">
            <div class="d-flex align-items-center gap-3">
                <div class="rounded-circle border d-inline-flex align-items-center justify-content-center"
                     style="width:72px;height:72px;overflow:hidden;background:rgba(0,0,0,.04);">
                    @if (hasPhoto)
                    {
                        <img src="@profilePictureUrl" alt="Profil Fotoğrafı" Fotoğrafı" style="width:72px;height:72px;object-fit:cover;" />
                    }
                    else
                    {
                        <span class="fw-semibold" style="font-size:22px; letter-spacing:.5px;">
                            @Model.Initials
                        </span>
                    }
                </div>

                <div class="flex-grow-1">
                    <div class="d-flex flex-wrap gap-2 align-items-center">
                        <div class="fw-semibold fs-5">@Model.FullName</div>
                        <span class="badge @BadgeClass(role)">@RoleLabel(role)</span>
                    </div>
                    <div class="text-muted small mt-1">
                        @p.Email
                        @if (!string.IsNullOrWhiteSpace(p.PhoneNumber))
                        {
                            <span> • @p.PhoneNumber</span>
                        }
                    </div>
                </div>
            </div>

            <hr class="my-3" />

            <div class="text-muted small">Kulüp</div>
            <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(p.TenantName) ? p.TenantName : "-")</div>

            <div class="text-muted small mt-3">Rol Bazlı</div>
            <div class="fw-semibold">
                @if (role == "Student")
                {
                    <span>Öğrenci</span>
                }
                else if (role == "Coach")
                {
                    <span>Koç</span>
                }
                else if (role == "Admin")
                {
                    <span>Admin</span>
                }
                else if (role == "SuperAdmin")
                {
                    <span>Super Admin</span>
                }
                else
                {
                    <span>-</span>
                }
            </div>

            <hr class="my-3" />

            <div class="d-grid gap-2">
                <a asp-controller="Profile" asp-action="Edit" class="btn btn-sm btn-primary">
                    Bilgilerimi Düzenle
                </a>

                <a asp-controller="Profile" asp-action="ChangePassword" class="btn btn-sm btn-outline-secondary">
                    Şifre Değiştir
                </a>

                <form asp-controller="Account" asp-action="Logout" method="post">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-sm btn-outline-danger w-100">
                        Çıkış Yap
                    </button>
                </form>
            </div>

            <div class="text-muted small mt-3">
                Profil fotoğrafı yükleme özelliği yakında eklenecek.
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-8">
        <div class="card-surface p-3">
            <div class="fw-semibold">Kişisel Bilgiler</div>

            <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                    <div class="text-muted small">Ad</div>
                    <div class="fw-semibold">@p.FirstName</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Soyad</div>
                    <div class="fw-semibold">@p.LastName</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Cinsiyet</div>
                    <div class="fw-semibold">@GenderLabel(p.Gender)</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Kan Grubu</div>
                    <div class="fw-semibold">@BloodLabel(p.BloodType)</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Doğum Tarihi</div>
                    <div class="fw-semibold">@p.BirthDate.ToString("dd.MM.yyyy")</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Telefon</div>
                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(p.PhoneNumber) ? p.PhoneNumber : "-")</div>
                </div>
            </div>

            <hr class="my-3" />

            <div class="fw-semibold">Kulüp / Operasyon</div>

            <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                    <div class="text-muted small">Kulüp</div>
                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(p.TenantName) ? p.TenantName : "-")</div>
                </div>

                <div class="col-12 col-md-6">
                    <div class="text-muted small">Şube</div>
                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(p.BranchName) ? p.BranchName : "-")</div>
                </div>

                @if (role == "Student")
                {
                    <div class="col-12 col-md-6">
                        <div class="text-muted small">Sınıf</div>
                        <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(p.ClassName) ? p.ClassName : "-")</div>
                    </div>

                    <div class="col-12">
                        <div class="alert alert-light border small mb-0">
                            Not: Şube/Sınıf bilgisi yönetim tarafından atanır; buradan değiştirilemez.
                        </div>
                    </div>
                }
                else if (role == "Coach")
                {
                    <div class="col-12">
                        <div class="alert alert-light border small mb-0">
                            İpucu: Koç panelinden gecikmiş aidatları ve eksik belgeleri takip edebilirsiniz.
                        </div>
                    </div>
                }
                else if (role == "Admin" || role == "SuperAdmin")
                {
                    <div class="col-12">
                        <div class="alert alert-light border small mb-0">
                            İpucu: Kulüp ayarları (tema, belge gereksinimleri vb.) için Ayarlar &gt; Kulüp Ayarları bölümünü kullanın.
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="card-surface p-3 mt-3">
            <div class="fw-semibold">Hızlı İşlemler</div>
            <div class="text-muted small mt-1">Sık kullanılan ekranlara geçiş.</div>

            <div class="d-flex flex-wrap gap-2 mt-3">
                @if (role == "Student")
                {
                    <a asp-controller="StudentDashboard" asp-action="Index" class="btn btn-sm btn-outline-primary">Dashboard</a>

                    <a asp-controller="Documents" asp-action="Student"
                       asp-route-studentId="@p.StudentProfileId"
                       class="btn btn-sm btn-outline-secondary">
                        Belgelerim
                    </a>

                    <a asp-controller="Attendance" asp-action="List" class="btn btn-sm btn-outline-secondary">
                        Yoklamalarım
                    </a>

                    <a asp-controller="ProgressRecords" asp-action="Student"
                       asp-route-studentId="@p.StudentProfileId"
                       class="btn btn-sm btn-outline-secondary">
                        Gelişim Kayıtlarım
                    </a>

                    <a asp-controller="Payments" asp-action="My" class="btn btn-sm btn-outline-secondary">Aidatlarım</a>
                    <a asp-controller="PaymentPlans" asp-action="My" class="btn btn-sm btn-outline-secondary">Aidat Planlarım</a>
                }
                else if (role == "Coach")
                {
                    <a asp-controller="CoachDashboard" asp-action="Index" class="btn btn-sm btn-outline-primary">Koç Paneli</a>
                    <a asp-controller="Attendance" asp-action="Index" class="btn btn-sm btn-outline-secondary">Antrenmanlar</a>
                    <a asp-controller="Payments" asp-action="Index" class="btn btn-sm btn-outline-secondary">Aidatlar</a>
                    <a asp-controller="Documents" asp-action="Coach"
                       asp-route-coachId="@p.CoachProfileId"
                       class="btn btn-sm btn-outline-secondary">
                        Belgelerim
                    </a>
                    <a asp-controller="Documents" asp-action="Students" asp-route-onlyIncomplete="true" class="btn btn-sm btn-outline-secondary">Eksik Belgeler</a>
                }
                else if (role == "Admin" || role == "SuperAdmin")
                {
                    <a asp-controller="AdminDashboard" asp-action="Index" class="btn btn-sm btn-outline-primary">Admin Paneli</a>
                    <a asp-controller="Students" asp-action="Index" class="btn btn-sm btn-outline-secondary">Öğrenciler</a>
                    <a asp-controller="Payments" asp-action="Index" class="btn btn-sm btn-outline-secondary">Aidatlar </a>
                    <a asp-controller="Attendance" asp-action="Index" class="btn btn-sm btn-outline-secondary">Antrenmanlar</a>
                    <a asp-controller="Settings" asp-action="Club" class="btn btn-sm btn-outline-secondary">Kulüp Ayarları</a>
                }
            </div>
        </div>
    </div>
</div>
