@model SuperAdminDashboardViewModel
@{
    ViewData["Title"] = "Sistem Yönetimi";

    var activeTenantName = string.IsNullOrWhiteSpace(Model.Stats.ActiveTenantName)
        ? "(Tenant seçilmemiş)"
        : Model.Stats.ActiveTenantName;

    var activeTenantId = Model.Stats.ActiveTenantId;
}

<div class="d-flex justify-content-between align-items-start mb-3">
    <div>
        <h2 class="mb-1">Sistem Yönetim Paneli</h2>
        <div class="text-muted small">Hoş geldin, @Model.UserDisplayName</div>
    </div>

    <div class="text-end">
        <div class="text-muted small">Aktif Kulüp</div>
        <div class="fw-semibold">
            @activeTenantName
            @if (activeTenantId.HasValue)
            {
                <span class="text-muted small">(#@activeTenantId.Value)</span>
            }
        </div>
        <div class="small text-muted">Tema/işlem bağlamı buna göre</div>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-3 col-sm-6">
        <div class="card-surface p-3">
            <div class="text-muted small">Kulüp</div>
            <div class="fs-4 fw-semibold">@Model.Stats.TotalTenants</div>
            <div class="text-muted small">Aktif: @Model.Stats.ActiveTenants</div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card-surface p-3">
            <div class="text-muted small">Öğrenci</div>
            <div class="fs-4 fw-semibold">@Model.Stats.TotalStudents</div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card-surface p-3">
            <div class="text-muted small">Koç</div>
            <div class="fs-4 fw-semibold">@Model.Stats.TotalCoaches</div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card-surface p-3">
            <div class="text-muted small">Sınıf</div>
            <div class="fs-4 fw-semibold">@Model.Stats.TotalClasses</div>
        </div>
    </div>
</div>

<div class="row g-3 mt-3">
    <div class="col-lg-6">
        <div class="card-surface p-3 h-100">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="text-muted small">Abonelik Bitişi Yaklaşanlar</div>
                    <div class="fw-semibold">Önümüzdeki 30 gün</div>
                </div>
                <div class="text-end">
                    <div class="text-muted small">Toplam</div>
                    <div class="fs-5 fw-semibold">@Model.Stats.ExpiringTenantsIn30Days</div>
                </div>
            </div>

            <div class="mt-3">
                @if (Model.Stats.ExpiringTenants is null || Model.Stats.ExpiringTenants.Count == 0)
                {
                    <div class="text-muted small">30 gün içinde biten aktif abonelik yok.</div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-sm align-middle mb-0">
                            <thead>
                                <tr class="text-muted small">
                                    <th>Kulüp</th>
                                    <th class="text-end">Bitiş</th>
                                    <th class="text-end">Kalan</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var t in Model.Stats.ExpiringTenants)
                                {
                                    <tr>
                                        <td>
                                            <div class="fw-semibold text-white">@t.Name</div>
                                            <div class="text-muted small">@t.Subdomain</div>
                                        </td>
                                        <td class="text-end text-danger">
                                            @t.SubscriptionEndDate.ToString("yyyy-MM-dd")
                                        </td>
                                        <td class="text-end text-danger">
                                            <span class="badge-soft badge-soft-warning">@t.DaysRemaining gün</span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    @if (Model.Stats.ExpiringTenantsIn30Days > Model.Stats.ExpiringTenants.Count)
                    {
                        <div class="text-muted small mt-2">
                            İlk @Model.Stats.ExpiringTenants.Count kayıt gösteriliyor.
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card-surface p-3 h-100">
            <div class="text-muted small">Sistem Sağlığı</div>
            <div class="fw-semibold">Durum Özeti</div>

            <div class="mt-3">
                <div class="d-flex justify-content-between">
                    <div class="text-muted small">Ortam</div>
                    <div class="fw-semibold">@Model.Stats.SystemHealth.Environment</div>
                </div>
                <hr class="my-2" />

                <div class="d-flex justify-content-between">
                    <div class="text-muted small">Email</div>
                    <div>
                        @if (Model.Stats.SystemHealth.EmailEnabled)
                        {
                            <span class="badge-soft badge-soft-success">Enabled</span>
                        }
                        else
                        {
                            <span class="badge-soft badge-soft-muted">Disabled</span>
                        }
                    </div>
                </div>
                <hr class="my-2" />

                <div class="d-flex justify-content-between">
                    <div class="text-muted small">Server UTC</div>
                    <div class="fw-semibold">@Model.Stats.SystemHealth.ServerUtcNow.ToString("yyyy-MM-dd HH:mm")</div>
                </div>
                <hr class="my-2" />

                <div class="d-flex justify-content-between">
                    <div class="text-muted small">Versiyon</div>
                    <div class="fw-semibold">@Model.Stats.SystemHealth.AppVersion</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mt-3">
    <div class="col-12">
        <div class="card-surface p-3">
            <div class="text-muted small">Kullanım</div>
            <div class="d-flex justify-content-between align-items-baseline mt-1">
                <div>
                    <div class="fw-semibold">Yaklaşan Programlar (Global)</div>
                    <div class="text-muted small">Tüm kulüpler için planlı program sayısı</div>
                </div>
                <div class="fs-4 fw-semibold">@Model.Stats.UpcomingSessions</div>
            </div>
        </div>
    </div>
</div>
