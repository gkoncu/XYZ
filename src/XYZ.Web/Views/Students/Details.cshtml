@model StudentDetailDto
@{
    ViewData["Title"] = "Öğrenci Detayı";
}

<section class="mb-3">
    <a asp-action="Index" class="text-muted small text-decoration-none">&larr; Öğrenci listesine dön</a>
</section>

<section class="mb-3 d-flex justify-content-between align-items-center">
    <a asp-action="Index" class="text-muted small text-decoration-none">&larr; Öğrenci listesine dön</a>

    <div>
        <a asp-controller="Attendance"
           asp-action="List"
           asp-route-studentId="@Model.Id"
           class="btn btn-sm btn-outline-light me-2">
            Yoklama Geçmişi
        </a>

        @if (User.IsInRole("Admin") || User.IsInRole("Coach") || User.IsInRole("SuperAdmin"))
        {
            <a asp-action="Edit"
               asp-route-id="@Model.Id"
               class="btn btn-sm btn-outline-light me-1">
                Düzenle
            </a>

            <form asp-action="Delete"
                  asp-route-id="@Model.Id"
                  method="post"
                  class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('Bu öğrenciyi silmek istediğinize emin misiniz?');">
                    Sil
                </button>
            </form>
        }
    </div>
</section>


<section class="detail-grid">
    <div class="card-surface">
        <h2 class="h5 mb-3">Öğrenci Bilgileri</h2>

        <div class="mb-3">
            <div class="fw-semibold fs-5">@Model.FullName</div>
            <div class="small text-muted">@Model.Email</div>
            @if (!string.IsNullOrWhiteSpace(Model.PhoneNumber))
            {
                <div class="small text-muted">@Model.PhoneNumber</div>
            }
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="small text-muted">Sınıf</div>
                <div>@(Model.ClassName ?? "Henüz atanmadı")</div>
            </div>
            <div class="col-md-4">
                <div class="small text-muted">Şube</div>
                <div>@(Model.BranchName ?? "-")</div>
            </div>
            <div class="col-md-4">
                <div class="small text-muted">Durum</div>
                @if (Model.IsActive)
                {
                    <span class="badge-soft badge-soft-success">Aktif</span>
                }
                else
                {
                    <span class="badge-soft badge-soft-muted">Pasif</span>
                }
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="small text-muted">Cinsiyet</div>
                <div>@Model.Gender</div>
            </div>
            <div class="col-md-4">
                <div class="small text-muted">Kan Grubu</div>
                <div>@Model.BloodType</div>
            </div>
            <div class="col-md-4">
                <div class="small text-muted">Doğum Tarihi</div>
                <div>@Model.BirthDate.ToString("dd.MM.yyyy")</div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <h3 class="h6 mb-2">Veli 1</h3>
                <div class="small text-muted">Ad Soyad</div>
                <div>@($"{Model.Parent1FirstName} {Model.Parent1LastName}".Trim())</div>
                <div class="small text-muted mt-2">E-posta</div>
                <div>@Model.Parent1Email</div>
                <div class="small text-muted mt-2">Telefon</div>
                <div>@Model.Parent1PhoneNumber</div>
            </div>
            <div class="col-md-6">
                <h3 class="h6 mb-2">Veli 2</h3>
                <div class="small text-muted">Ad Soyad</div>
                <div>@($"{Model.Parent2FirstName} {Model.Parent2LastName}".Trim())</div>
                <div class="small text-muted mt-2">E-posta</div>
                <div>@Model.Parent2Email</div>
                <div class="small text-muted mt-2">Telefon</div>
                <div>@Model.Parent2PhoneNumber</div>
            </div>
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.MedicalInformation) || !string.IsNullOrWhiteSpace(Model.Notes))
        {
            <hr class="my-4" />
            <div class="row g-3">
                @if (!string.IsNullOrWhiteSpace(Model.MedicalInformation))
                {
                    <div class="col-md-6">
                        <h3 class="h6 mb-2">Sağlık Bilgileri</h3>
                        <p class="small text-muted mb-0">@Model.MedicalInformation</p>
                    </div>
                }
                @if (!string.IsNullOrWhiteSpace(Model.Notes))
                {
                    <div class="col-md-6">
                        <h3 class="h6 mb-2">Notlar</h3>
                        <p class="small text-muted mb-0">@Model.Notes</p>
                    </div>
                }
            </div>
        }
    </div>

    <div class="card-surface">
        <h2 class="h6 mb-3">Özet</h2>
        <dl class="row small mb-0">
            <dt class="col-5 text-muted">Kayıt Tarihi</dt>
            <dd class="col-7">@Model.CreatedAt.ToString("dd.MM.yyyy HH:mm")</dd>

            @if (Model.UpdatedAt.HasValue)
            {
                <dt class="col-5 text-muted">Son Güncelleme</dt>
                <dd class="col-7">@Model.UpdatedAt.Value.ToString("dd.MM.yyyy HH:mm")</dd>
            }
        </dl>

        @* TODO: yoklama özeti, ilerleme grafiği, ödeme durumu gibi widget'lar *@
    </div>
</section>
